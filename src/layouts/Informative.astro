---
import BaseHead from "../components/BaseHead.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";

import { getLangFromUrl, useTranslations } from "../i18n/utils";

const { props } = Astro.props;

let temp =  props;

const data = temp.remarkPluginFrontmatter;

let video = data.heroVideo
let legendes = data.legendes

if (video)
{
  console.log(video)
}

let legendesExtraites = [""];

if (legendes) {
  legendesExtraites = legendes;
}


let pathStr = String(Astro.url.pathname);

if (pathStr.charAt(0) === "/") pathStr = pathStr.substring(1, pathStr.length);

if (pathStr.charAt(pathStr.length - 1) === "/")
  pathStr = pathStr.substring(0, pathStr.length - 1);


const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
---

<html lang={lang}>
  <head>
    <BaseHead title="Archives" description="description" />
    <style>
      .hero-image {
        width: 100%;
      }
      .hero-image img {
        display: block;
        position: relative;
        top: 0;
        left: 0;
        right: 0;
        opacity: 1;
        margin: 0 auto;
        margin-left: auto;
        margin-right: auto;
        border-radius: 0;
        box-shadow: var(--box-shadow);
        z-index: 1;
      }

      .prose {
        width: 720px;
        max-width: calc(100% - 2em);
        margin: auto;
        color: rgb(var(--gray-dark));
        z-index: 1;
        position: relative;
        padding-top: 40px;
      }
      .title {
        margin-bottom: 1em;
        padding: 1em 0;
        text-align: center;
        line-height: 1;
      }
      .title h1 {
        margin: 0 0 0.5em 0;
      }
      .date {
        margin-bottom: 0.5em;
        color: black;
      }
      .last-updated-on {
        font-style: italic;
      }

      .sufficent-margin {
        margin-bottom: -18rem;
      }

      @media (min-width: 768px) {
        .prose {
          padding: 1em;
        }

        .hero-image img {
          display: block;
          margin: 0 auto;
          position: relative;
          border-radius: 12px;
          box-shadow: var(--box-shadow);
          height: 50vh;
        }
        main {
          margin: auto;
          padding-top: 0;
        }
      }
    </style>
  </head>

  <body>
    <Header numeroPage={data.translation} />
    
    <main
      class="w-full pt-0 ps-0 pe-0 max-w-fit md:max-w-[calc(100%-2rem)] md:w-[calc(100%-2rem)] md:pt-32"
    >
    
      <article>
        <div class="hero-image md:pt-24">
          <div class="flex items-start xl:mx-[15%] 2xl:mx-[25vw]">
            <p class=" text-[16px] opacityFade text-justify"></p>
            <video class="w-[900px] h-[300px] object-cover m-auto flex opacityFade" preload="auto" loop autoplay src=`/${video}`></video>

          </div>
          <div class="flex items-start xl:mx-[15%] 2xl:mx-[25vw]">
            <p class="legende text-[16px] opacityFade text-justify pb-[75px]">
              {legendesExtraites[0]}
            </p>
          </div>
        </div>
        <div class="prose px-[7vw] sm:px-0">
          <div class="title">
            <h1 class="text-5xl">{data.title}</h1>
            

            <hr />
          </div>
          <slot />
        </div>
      </article>
    </main>
    <Footer numeroPage={`0`} />
  </body>
</html>

<script>
  const header = document.querySelectorAll(".opacityFade") as NodeListOf<HTMLElement>;
  const prose = document.querySelector(".prose") as HTMLElement;
  const article = document.querySelector("article") as HTMLElement;
  window.addEventListener("scroll", function () {
    let scrollTop = window.scrollY || document.documentElement.scrollTop;
    let result = String(1 - scrollTop / 250);
    if (header !== null) {
      let res = parseInt(result);
      if (res >= 0) {
         header.forEach((element: HTMLElement) => {
          element.style.opacity = result;
        });
        prose.style.translate = `0 ${1 - scrollTop}px`;
        /*if (res === 1) {
          if (!article.classList.contains("sufficent-margin"))
            article.classList.add("sufficent-margin");
        }*/
      }
    }

    window.onbeforeprint = function () {
      header.forEach((element: HTMLElement) =>{
        element.style.opacity = "1";
      })
      prose.style.translate = `0px`;
    };

    window.onafterprint = function () {
      header.forEach((element: HTMLElement) =>{
        element.style.opacity = result;
      })
      prose.style.translate = `0 ${1 - scrollTop}px`;
    };

  });


 

</script>
